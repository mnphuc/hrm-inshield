<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section th:fragment="content" class="grid two-columns" >
    <div class="card">
        <form th:action="@{/cms/leave}" th:object="${leaveForm}" method="post" class="form-grid">
            <div class="field">
                <label for="leaveEmployee">Nhân viên</label>
                <select id="leaveEmployee" th:field="*{employeeId}">
                    <option value="">-- Chọn nhân viên --</option>
                    <option th:each="employee : ${employees}"
                            th:value="${employee.id}"
                            th:text="${employee.fullName}">Nhân viên</option>
                </select>
                <small th:if="${#fields.hasErrors('employeeId')}" th:errors="*{employeeId}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="leaveType">Loại nghỉ</label>
                <select id="leaveType" th:field="*{type}">
                    <option value="">-- Chọn loại --</option>
                    <option th:each="type : ${leaveTypes}"
                            th:value="${type}"
                            th:text="${type}">TYPE</option>
                </select>
                <small th:if="${#fields.hasErrors('type')}" th:errors="*{type}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="leaveStart">Ngày bắt đầu</label>
                <input id="leaveStart" th:field="*{startDate}" type="date">
                <small th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="leaveEnd">Ngày kết thúc</label>
                <input id="leaveEnd" th:field="*{endDate}" type="date">
                <small th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="totalDays">Tổng số ngày</label>
                <input id="totalDays" th:field="*{totalDays}" type="number" step="0.5">
                <small th:if="${#fields.hasErrors('totalDays')}" th:errors="*{totalDays}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="reason">Lý do</label>
                <textarea id="reason" th:field="*{reason}" rows="3"></textarea>
            </div>
            <div class="actions">
                <button type="submit">Gửi đơn</button>
            </div>
        </form>
    </div>

    <div class="card " style="grid-column: span 2">
        <h2>Chờ duyệt</h2>
        <table class="data-table">
            <thead>
            <tr>
                <th>Nhân viên</th>
                <th>Loại</th>
                <th>Thời gian</th>
                <th>Trạng thái</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="leave : ${pendingRequests}">
                <td th:text="${employeeNames[leave.employeeId]} ?: '—'">Nhân viên</td>
                <td th:text="${leave.type}">ANNUAL</td>
                <td>
                    <span th:text="${leave.startDate}">2024-01-01</span>
                    <span> - </span>
                    <span th:text="${leave.endDate}">2024-01-05</span>
                    <span th:text="'(' + ${leave.totalDays} + ' ngày)'"></span>                </td>
                <td th:text="${leave.status}">PENDING</td>
                <td class="actions-cell">
                    <div>
                    <form th:action="@{/cms/leave/{id}/decision(id=${leave.id})}" method="post" th:object="${decisionForm}">
                        <select th:field="*{status}" th:id="'leave-status-' + ${leave.id}">
                            <option th:each="status : ${leaveStatuses}"
                                    th:value="${status}"
                                    th:selected="${status} == ${leave.status}"
                                    th:text="${status}">STATUS</option>
                        </select>
                        <select th:field="*{approverId}" th:id="'leave-approver-' + ${leave.id}">
                            <option value="">-- Người duyệt --</option>
                            <option th:each="employee : ${employees}"
                                    th:value="${employee.id}"
                                    th:text="${employee.fullName}">Người duyệt</option>
                        </select>
                        <button type="submit">Cập nhật</button>
                    </form>
                    <form th:action="@{/cms/leave/{id}/delete(id=${leave.id})}" method="post">
                        <button type="submit" class="link danger" onclick="return confirm('Bạn có muốn xóa đơn nghỉ?');">Xóa</button>
                    </form>
                    </div>
                </td>
            </tr>
            <tr th:if="${pendingRequests.isEmpty()}">
                <td colspan="5" class="empty">Chưa có đơn chờ duyệt</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="card full-span">
        <h2>Tất cả đơn</h2>
        <table class="data-table">
            <thead>
            <tr>
                <th>Nhân viên</th>
                <th>Loại</th>
                <th>Thời gian</th>
                <th>Trạng thái</th>
                <th>Người duyệt</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="leave : ${leaveRequests}">
                <td th:text="${employeeNames[leave.employeeId]} ?: '—'">Nhân viên</td>
                <td th:text="${leave.type}">ANNUAL</td>
                <td>
                    <span th:text="${leave.startDate}">2024-01-01</span>
                    <span> - </span>
                    <span th:text="${leave.endDate}">2024-01-05</span>
                    <span th:text="'(' + ${leave.totalDays} + ' ngày)'"></span>
                </td>
                <td th:text="${leave.status}">APPROVED</td>
                <td th:text="${leave.approverId != null ? employeeNames[leave.approverId] : '—'}">—</td>
            </tr>
            <tr th:if="${leaveRequests.isEmpty()}">
                <td colspan="5" class="empty">Chưa có đơn nghỉ phép</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
</html>


