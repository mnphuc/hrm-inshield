<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section th:fragment="content" class="grid two-columns">
    <div class="card">
        <form th:action="@{/cms/leave}" th:object="${leaveForm}" method="post" class="form-grid">
            <div class="field">
                <label for="leaveEmployee">Employee</label>
                <select id="leaveEmployee" th:field="*{employeeId}">
                    <option value="">-- Select employee --</option>
                    <option th:each="employee : ${employees}"
                            th:value="${employee.id}"
                            th:text="${employee.fullName}">Employee</option>
                </select>
                <small th:if="${#fields.hasErrors('employeeId')}" th:errors="*{employeeId}" class="error-text">Invalid</small>
            </div>
            <div class="field">
                <label for="leaveType">Leave type</label>
                <select id="leaveType" th:field="*{type}">
                    <option value="">-- Select type --</option>
                    <option th:each="type : ${leaveTypes}"
                            th:value="${type}"
                            th:text="${type}">TYPE</option>
                </select>
                <small th:if="${#fields.hasErrors('type')}" th:errors="*{type}" class="error-text">Invalid</small>
            </div>
            <div class="field">
                <label for="leaveStart">Start date</label>
                <input id="leaveStart" th:field="*{startDate}" type="date">
                <small th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}" class="error-text">Invalid</small>
            </div>
            <div class="field">
                <label for="leaveEnd">End date</label>
                <input id="leaveEnd" th:field="*{endDate}" type="date">
                <small th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}" class="error-text">Invalid</small>
            </div>
            <div class="field">
                <label for="totalDays">Total days</label>
                <input id="totalDays" th:field="*{totalDays}" type="number" step="0.5">
                <small th:if="${#fields.hasErrors('totalDays')}" th:errors="*{totalDays}" class="error-text">Invalid</small>
            </div>
            <div class="field">
                <label for="reason">Reason</label>
                <textarea id="reason" th:field="*{reason}" rows="3"></textarea>
            </div>
            <div class="actions">
                <button type="submit">Submit leave</button>
            </div>
        </form>
    </div>

    <div class="card">
        <h2>Pending approval</h2>
        <table class="data-table">
            <thead>
            <tr>
                <th>Employee</th>
                <th>Type</th>
                <th>Duration</th>
                <th>Status</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="leave : ${pendingRequests}">
                <td th:text="${#lists.find(employees, e -> e.id == leave.employeeId)?.fullName}">Employee</td>
                <td th:text="${leave.type}">ANNUAL</td>
                <td>
                    <span th:text="${leave.startDate}">2024-01-01</span>
                    <span> - </span>
                    <span th:text="${leave.endDate}">2024-01-05</span>
                    <span th:text="' (' + leave.totalDays + ' days)'"></span>
                </td>
                <td th:text="${leave.status}">PENDING</td>
                <td class="actions-cell">
                    <form th:action="@{/cms/leave/{id}/decision(id=${leave.id})}" method="post" th:object="${decisionForm}">
                        <select th:field="*{status}" th:id="'leave-status-' + ${leave.id}">
                            <option th:each="status : ${leaveStatuses}"
                                    th:value="${status}"
                                    th:selected="${status} == ${leave.status}"
                                    th:text="${status}">STATUS</option>
                        </select>
                        <select th:field="*{approverId}" th:id="'leave-approver-' + ${leave.id}">
                            <option value="">-- Approver --</option>
                            <option th:each="employee : ${employees}"
                                    th:value="${employee.id}"
                                    th:text="${employee.fullName}">Approver</option>
                        </select>
                        <button type="submit">Update</button>
                    </form>
                    <form th:action="@{/cms/leave/{id}/delete(id=${leave.id})}" method="post">
                        <button type="submit" class="link danger" onclick="return confirm('Delete leave request?');">Delete</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${pendingRequests.isEmpty()}">
                <td colspan="5" class="empty">No pending requests</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="card full-span">
        <h2>All requests</h2>
        <table class="data-table">
            <thead>
            <tr>
                <th>Employee</th>
                <th>Type</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Approver</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="leave : ${leaveRequests}">
                <td th:text="${#lists.find(employees, e -> e.id == leave.employeeId)?.fullName}">Employee</td>
                <td th:text="${leave.type}">ANNUAL</td>
                <td>
                    <span th:text="${leave.startDate}">2024-01-01</span>
                    <span> - </span>
                    <span th:text="${leave.endDate}">2024-01-05</span>
                    <span th:text="' (' + leave.totalDays + ' days)'"></span>
                </td>
                <td th:text="${leave.status}">APPROVED</td>
                <td th:text="${#lists.find(employees, e -> e.id == leave.approverId)?.fullName}">Approver</td>
            </tr>
            <tr th:if="${leaveRequests.isEmpty()}">
                <td colspan="5" class="empty">No leave requests</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
</html>
