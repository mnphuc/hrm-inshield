<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section th:fragment="content" class="grid two-columns">
    <div class="card">
        <form th:action="@{/cms/payrolls}" th:object="${payrollForm}" method="post" class="form-grid">
            <div class="field">
                <label for="payrollEmployee">Nhân viên</label>
                <select id="payrollEmployee" th:field="*{employeeId}">
                    <option value="">-- Chọn nhân viên --</option>
                    <option th:each="employee : ${employees}"
                            th:value="${employee.id}"
                            th:text="${employee.fullName}">Nhân viên</option>
                </select>
                <small th:if="${#fields.hasErrors('employeeId')}" th:errors="*{employeeId}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="payrollYear">Năm</label>
                <input id="payrollYear" th:field="*{payrollYear}" type="number" min="2000" placeholder="2025">
                <small th:if="${#fields.hasErrors('payrollYear')}" th:errors="*{payrollYear}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="payrollMonth">Tháng</label>
                <input id="payrollMonth" th:field="*{payrollMonth}" type="number" min="1" max="12" placeholder="10">
                <small th:if="${#fields.hasErrors('payrollMonth')}" th:errors="*{payrollMonth}" class="error-text">Lỗi</small>
            </div>
            <div class="field">
                <label for="baseSalary">Lương cơ bản</label>
                <input id="baseSalary" th:field="*{baseSalary}" type="number" step="0.01" placeholder="15000000">
            </div>
            <div class="field">
                <label for="overtimeHours">Số giờ tăng ca</label>
                <input id="overtimeHours" th:field="*{overtimeHours}" type="number" step="0.25">
            </div>
            <div class="field">
                <label for="overtimeAmount">Tiền tăng ca</label>
                <input id="overtimeAmount" th:field="*{overtimeAmount}" type="number" step="0.01">
            </div>
            <div class="field">
                <label for="bonus">Thưởng</label>
                <input id="bonus" th:field="*{bonus}" type="number" step="0.01">
            </div>
            <div class="field">
                <label for="deductions">Khấu trừ</label>
                <input id="deductions" th:field="*{deductions}" type="number" step="0.01">
            </div>
            <div class="actions">
                <button type="submit">Tính bảng lương</button>
            </div>
        </form>
    </div>

    <div class="card">
        <form class="filters" method="get" th:action="@{/cms/payrolls}">
            <select name="employeeId">
                <option value="">-- Tất cả nhân viên --</option>
                <option th:each="employee : ${employees}"
                        th:value="${employee.id}"
                        th:selected="${employee.id == selectedEmployeeId}"
                        th:text="${employee.fullName}">Nhân viên</option>
            </select>
            <button type="submit">Lọc</button>
        </form>
        <table class="data-table">
            <thead>
            <tr>
                <th>Nhân viên</th>
                <th>Kỳ lương</th>
                <th>Lương cơ bản</th>
                <th>Tăng ca</th>
                <th>Thưởng</th>
                <th>Khấu trừ</th>
                <th>Thực lĩnh</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="payroll : ${payrolls}">
<!--                <td th:text="${#maps.get(employeeNames, payroll.employeeId) ?: '—'}">Nhân viên</td>-->
                <td th:text="${employeeNames[payroll.employeeId]} ?: '—'">Nhân viên</td>
                <td th:text="${payroll.payrollMonth + '/' + payroll.payrollYear}">10/2025</td>
                <td th:text="${#numbers.formatDecimal(payroll.baseSalary, 1, 'DEFAULT', 2, 'DEFAULT')}">0</td>
                <td>
                    <span th:text="${payroll.overtimeHours}">0</span>h /
                    <span th:text="${#numbers.formatDecimal(payroll.overtimeAmount, 1, 'DEFAULT', 2, 'DEFAULT')}">0</span>
                </td>
                <td th:text="${#numbers.formatDecimal(payroll.bonus, 1, 'DEFAULT', 2, 'DEFAULT')}">0</td>
                <td th:text="${#numbers.formatDecimal(payroll.deductions, 1, 'DEFAULT', 2, 'DEFAULT')}">0</td>
                <td class="highlight" th:text="${#numbers.formatDecimal(payroll.netPay, 1, 'DEFAULT', 2, 'DEFAULT')}">0</td>
            </tr>
            <tr th:if="${payrolls.isEmpty()}">
                <td colspan="7" class="empty">Chưa có dữ liệu bảng lương</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
</html>


