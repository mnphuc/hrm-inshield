<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section th:fragment="content">
    <div class="card">
        <div class="table-actions">
            <div>
                <button type="button" class="button" data-open-modal="employeeModal" data-mode="create">
                    + Thêm nhân viên
                </button>
            </div>
            <div class="pagination" th:if="${totalPages > 1}">
                <a class="page-link"
                   th:classappend="${currentPage == 0}? 'disabled'"
                   th:href="${currentPage == 0}? '#': @{/cms/employees(page=${currentPage - 1}, size=${pageSize})}">Trang trước</a>
                <a class="page-link"
                   th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                   th:text="${pageNum + 1}"
                   th:href="@{/cms/employees(page=${pageNum}, size=${pageSize})}"
                   th:classappend="${pageNum == currentPage}? 'active'">1</a>
                <a class="page-link"
                   th:classappend="${currentPage + 1 >= totalPages}? 'disabled'"
                   th:href="${currentPage + 1 >= totalPages}? '#': @{/cms/employees(page=${currentPage + 1}, size=${pageSize})}">Trang sau</a>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="data-table">
                <thead>
                <tr>
                    <th>Mã</th>
                    <th>Họ tên</th>
                    <th>Phòng ban</th>
                    <th>Chức vụ</th>
                    <th>Ngày vào làm</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="employee : ${employees}">
                    <td th:text="${employee.code}">EMP-001</td>
                    <td th:text="${employee.fullName}">Nguyễn Văn A</td>
                    <td th:text="${employee.department}">Phòng Kinh doanh</td>
                    <td th:text="${employee.position}">Nhân viên</td>
                    <td th:text="${employee.hireDate}">2024-01-01</td>
                    <td th:text="${employee.employmentStatus}">DANG LAM VIEC</td>
                    <td class="actions-cell">
                        <button type="button" class="button-link" data-open-modal="employeeModal" data-mode="edit"
                                th:attr="data-record-id=${employee.id},
                                         data-update-url=@{/cms/employees/{id}/update(id=${employee.id})},
                                         data-value-code=${employee.code},
                                         data-value-full-name=${employee.fullName},
                                         data-value-email=${employee.email},
                                         data-value-phone=${employee.phone},
                                         data-value-department=${employee.department},
                                         data-value-position=${employee.position},
                                         data-value-hire-date=${employee.hireDate},
                                         data-value-termination-date=${employee.terminationDate},
                                         data-value-employment-status=${employee.employmentStatus},
                                         data-value-base-salary=${employee.baseSalary},
                                         data-value-manager-id=${employee.managerId},
                                         data-value-user-id=${employee.userId}">
                            Chỉnh sửa
                        </button>
                        <form th:action="@{/cms/employees/{id}/delete(id=${employee.id})}" method="post"
                              th:attr="data-confirm-message=${'Bạn có chắc muốn xóa ' + employee.fullName + '?'}">
                            <button type="submit" class="link danger">Xóa</button>
                        </form>
                    </td>
                </tr>
                <tr th:if="${employees.isEmpty()}">
                    <td colspan="7" class="empty">Chưa có nhân viên nào</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="table-summary" th:if="${totalElements > 0}">
    <span th:text="|Đang hiển thị ${startIndex} - ${endIndex} / ${totalElements} Nhân viên|">
        Tổng quan
    </span>
        </div>


    </div>

    <div class="modal-backdrop"
         id="employeeModal"
         data-modal
         th:data-open="${showModal} ? 'true' : 'false'"
         th:data-mode="${modalMode}"
         th:data-record-id="${editId}"
         th:data-create-url="@{/cms/employees}"
         data-create-title="Thêm nhân viên"
         data-edit-title="Cập nhật nhân viên"
         data-create-text="Lưu"
         data-edit-text="Cập nhật">
        <div class="modal">
            <div class="modal-header">
                <h2 data-modal-title>Quản lý nhân viên</h2>
                <button type="button" class="icon-button" data-close-modal>&times;</button>
            </div>
            <form id="employeeForm" th:action="@{/cms/employees}" th:object="${employeeForm}" method="post">
                <div class="modal-body">
                    <!-- Thông tin cơ bản -->
                    <div class="form-section">
                        <h3 class="section-title">Thông tin cơ bản</h3>
                        <div class="grid two-columns">
                            <div class="field">
                                <label for="code">Mã nhân viên</label>
                                <input id="code" th:field="*{code}" data-field="code" type="text" placeholder="EMP-001">
                                <small th:if="${#fields.hasErrors('code')}" th:errors="*{code}" class="error-text">Lỗi</small>
                            </div>
                            <div class="field">
                                <label for="fullName">Họ tên</label>
                                <input id="fullName" th:field="*{fullName}" data-field="fullName" type="text" placeholder="Nguyễn Văn A">
                                <small th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}" class="error-text">Lỗi</small>
                            </div>
                            <div class="field">
                                <label for="email">Email</label>
                                <input id="email" th:field="*{email}" data-field="email" type="email" placeholder="nguoidung@techshield.vn">
                                <small th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error-text">Lỗi</small>
                            </div>
                            <div class="field">
                                <label for="phone">Điện thoại</label>
                                <input id="phone" th:field="*{phone}" data-field="phone" type="text" placeholder="0901234567">
                            </div>
                        </div>
                    </div>

                    <!-- Thông tin công việc -->
                    <div class="form-section">
                        <h3 class="section-title">Thông tin công việc</h3>
                        <div class="grid two-columns">
                            <div class="field">
                                <label for="department">Phòng ban</label>
                                <input id="department" th:field="*{department}" data-field="department" type="text" placeholder="Kinh doanh">
                            </div>
                            <div class="field">
                                <label for="position">Chức vụ</label>
                                <input id="position" th:field="*{position}" data-field="position" type="text" placeholder="Trưởng nhóm">
                            </div>
                            <div class="field">
                                <label for="hireDate">Ngày vào làm</label>
                                <input id="hireDate" th:field="*{hireDate}" data-field="hireDate" type="date">
                                <small th:if="${#fields.hasErrors('hireDate')}" th:errors="*{hireDate}" class="error-text">Lỗi</small>
                            </div>
                            <div class="field">
                                <label for="terminationDate">Ngày nghỉ việc</label>
                                <input id="terminationDate" th:field="*{terminationDate}" data-field="terminationDate" type="date">
                            </div>
                            <div class="field">
                                <label for="employmentStatus">Trạng thái</label>
                                <input id="employmentStatus" th:field="*{employmentStatus}" data-field="employmentStatus" type="text" placeholder="ĐANG LÀM VIỆC">
                            </div>
                            <div class="field">
                                <label for="baseSalary">Lương cơ bản</label>
                                <input id="baseSalary" th:field="*{baseSalary}" data-field="baseSalary" type="number" step="0.01" placeholder="15000000">
                            </div>
                        </div>
                    </div>

                    <!-- Thông tin quản lý -->
                    <div class="form-section">
                        <h3 class="section-title">Thông tin quản lý</h3>
                        <div class="grid two-columns">
                            <div class="field">
                                <label for="managerId">Quản lý trực tiếp</label>
                                <select id="managerId" th:field="*{managerId}" data-field="managerId">
                                    <option value="">-- Không có --</option>
                                    <option th:each="manager : ${managerOptions}"
                                            th:value="${manager.id}"
                                            th:text="${manager.fullName}">Quản lý</option>
                                </select>
                            </div>
                            <div class="field">
                                <label for="userId">Tài khoản liên kết</label>
                                <input id="userId" th:field="*{userId}" data-field="userId" type="number" placeholder="ID tài khoản">
                            </div>
                        </div>
                    </div>

                    <!-- Phân quyền -->
                    <div class="form-section">
                        <h3 class="section-title">Phân quyền</h3>
                        <div class="checkbox-group">
                            <div th:each="role : ${roleOptions}">
                                <label>
                                    <input type="checkbox"
                                           th:value="${role}"
                                           th:field="*{roles}" />
                                    <span th:text="${role}">ROLE</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="button secondary" data-close-modal>Hủy</button>
                    <button type="submit" class="button" data-modal-submit>Lưu</button>
                </div>
            </form>
        </div>
    </div>
</section>
</html>


