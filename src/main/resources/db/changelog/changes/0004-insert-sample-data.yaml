databaseChangeLog:
  # Insert sample users
  - changeSet:
      id: 0004-sample-users
      author: codex
      changes:
        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: hr_manager
              - column:
                  name: email
                  value: hr@techshield.vn
              - column:
                  name: password
                  value: "$2b$10$1CiUFXwl.04cE1YXXuMtF.rGEESCAyfyf9vw4GTWUQte6Y0yHzrU."
              - column:
                  name: enabled
                  valueBoolean: true
              - column:
                  name: account_non_locked
                  valueBoolean: true
        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: manager1
              - column:
                  name: email
                  value: manager1@techshield.vn
              - column:
                  name: password
                  value: "$2b$10$1CiUFXwl.04cE1YXXuMtF.rGEESCAyfyf9vw4GTWUQte6Y0yHzrU."
              - column:
                  name: enabled
                  valueBoolean: true
              - column:
                  name: account_non_locked
                  valueBoolean: true
        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: employee1
              - column:
                  name: email
                  value: employee1@techshield.vn
              - column:
                  name: password
                  value: "$2b$10$1CiUFXwl.04cE1YXXuMtF.rGEESCAyfyf9vw4GTWUQte6Y0yHzrU."
              - column:
                  name: enabled
                  valueBoolean: true
              - column:
                  name: account_non_locked
                  valueBoolean: true
        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: employee2
              - column:
                  name: email
                  value: employee2@techshield.vn
              - column:
                  name: password
                  value: "$2b$10$1CiUFXwl.04cE1YXXuMtF.rGEESCAyfyf9vw4GTWUQte6Y0yHzrU."
              - column:
                  name: enabled
                  valueBoolean: true
              - column:
                  name: account_non_locked
                  valueBoolean: true
        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: employee3
              - column:
                  name: email
                  value: employee3@techshield.vn
              - column:
                  name: password
                  value: "$2b$10$1CiUFXwl.04cE1YXXuMtF.rGEESCAyfyf9vw4GTWUQte6Y0yHzrU."
              - column:
                  name: enabled
                  valueBoolean: true
              - column:
                  name: account_non_locked
                  valueBoolean: true
        - sql:
            sql: |
              INSERT INTO user_roles (user_id, role_id)
              SELECT u.id, r.id FROM users u, roles r
              WHERE u.username = 'hr_manager' AND r.name = 'HR';
        - sql:
            sql: |
              INSERT INTO user_roles (user_id, role_id)
              SELECT u.id, r.id FROM users u, roles r
              WHERE u.username = 'manager1' AND r.name = 'MANAGER';
        - sql:
            sql: |
              INSERT INTO user_roles (user_id, role_id)
              SELECT u.id, r.id FROM users u, roles r
              WHERE u.username IN ('employee1', 'employee2', 'employee3') AND r.name = 'EMPLOYEE';

  # Insert sample employees
  - changeSet:
      id: 0004-sample-employees
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary, user_id)
              SELECT 'EMP001', 'Nguyễn Văn An', 'hr@techshield.vn', '0901234567', 'Nhân sự', 'Trưởng phòng Nhân sự', '2023-01-15', 'ACTIVE', 25000000, u.id
              FROM users u WHERE u.username = 'hr_manager';
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary, user_id)
              SELECT 'EMP002', 'Trần Thị Bình', 'manager1@techshield.vn', '0901234568', 'Phát triển', 'Trưởng nhóm Phát triển', '2023-02-01', 'ACTIVE', 30000000, u.id
              FROM users u WHERE u.username = 'manager1';
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary, user_id, manager_id)
              SELECT 'EMP003', 'Lê Văn Cường', 'employee1@techshield.vn', '0901234569', 'Phát triển', 'Lập trình viên', '2023-03-01', 'ACTIVE', 15000000, u.id, 
                     (SELECT id FROM employees WHERE code = 'EMP002')
              FROM users u WHERE u.username = 'employee1';
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary, user_id, manager_id)
              SELECT 'EMP004', 'Phạm Thị Dung', 'employee2@techshield.vn', '0901234570', 'Phát triển', 'Lập trình viên', '2023-03-15', 'ACTIVE', 15000000, u.id,
                     (SELECT id FROM employees WHERE code = 'EMP002')
              FROM users u WHERE u.username = 'employee2';
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary, user_id, manager_id)
              SELECT 'EMP005', 'Hoàng Văn Em', 'employee3@techshield.vn', '0901234571', 'Kinh doanh', 'Nhân viên Kinh doanh', '2023-04-01', 'ACTIVE', 12000000, u.id,
                     (SELECT id FROM employees WHERE code = 'EMP001')
              FROM users u WHERE u.username = 'employee3';
        - sql:
            sql: |
              INSERT INTO employees (code, full_name, email, phone, department, position, hire_date, employment_status, base_salary)
              VALUES 
              ('EMP006', 'Võ Thị Phương', 'phuong.vo@techshield.vn', '0901234572', 'Kế toán', 'Kế toán viên', '2023-05-01', 'ACTIVE', 13000000),
              ('EMP007', 'Đặng Văn Giang', 'giang.dang@techshield.vn', '0901234573', 'Phát triển', 'Lập trình viên Senior', '2023-01-10', 'ACTIVE', 20000000),
              ('EMP008', 'Bùi Thị Hoa', 'hoa.bui@techshield.vn', '0901234574', 'Marketing', 'Chuyên viên Marketing', '2023-06-01', 'ACTIVE', 14000000);

  # Insert sample projects
  - changeSet:
      id: 0004-sample-projects
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO projects (code, name, description, start_date, end_date, status, manager_id)
              SELECT 'PRJ001', 'Hệ thống Quản lý Nhân sự', 'Phát triển hệ thống quản lý nhân sự nội bộ', '2024-01-01', '2024-12-31', 'ACTIVE',
                     (SELECT id FROM employees WHERE code = 'EMP002');
        - sql:
            sql: |
              INSERT INTO projects (code, name, description, start_date, end_date, status, manager_id)
              SELECT 'PRJ002', 'Website Thương mại Điện tử', 'Xây dựng website bán hàng trực tuyến', '2024-02-01', '2024-08-31', 'ACTIVE',
                     (SELECT id FROM employees WHERE code = 'EMP002');
        - sql:
            sql: |
              INSERT INTO projects (code, name, description, start_date, end_date, status, manager_id)
              VALUES 
              ('PRJ003', 'Ứng dụng Mobile Banking', 'Phát triển ứng dụng ngân hàng di động', '2023-11-01', '2024-05-31', 'COMPLETED',
               (SELECT id FROM employees WHERE code = 'EMP002')),
              ('PRJ004', 'Hệ thống CRM', 'Quản lý quan hệ khách hàng', '2024-03-01', '2024-09-30', 'ACTIVE',
               (SELECT id FROM employees WHERE code = 'EMP002'));

  # Insert sample project assignments
  - changeSet:
      id: 0004-sample-project-assignments
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO project_assignments (project_id, employee_id, role_name, allocation_percent, start_date, end_date)
              SELECT p.id, e.id, 'Developer', 100.00, '2024-01-01', '2024-12-31'
              FROM projects p, employees e
              WHERE p.code = 'PRJ001' AND e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO project_assignments (project_id, employee_id, role_name, allocation_percent, start_date, end_date)
              SELECT p.id, e.id, 'Developer', 80.00, '2024-01-01', '2024-12-31'
              FROM projects p, employees e
              WHERE p.code = 'PRJ001' AND e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO project_assignments (project_id, employee_id, role_name, allocation_percent, start_date, end_date)
              SELECT p.id, e.id, 'Senior Developer', 100.00, '2024-02-01', '2024-08-31'
              FROM projects p, employees e
              WHERE p.code = 'PRJ002' AND e.code = 'EMP007';
        - sql:
            sql: |
              INSERT INTO project_assignments (project_id, employee_id, role_name, allocation_percent, start_date, end_date)
              SELECT p.id, e.id, 'Developer', 50.00, '2024-02-01', '2024-08-31'
              FROM projects p, employees e
              WHERE p.code = 'PRJ002' AND e.code = 'EMP003';

  # Insert sample partners
  - changeSet:
      id: 0004-sample-partners
      author: codex
      changes:
        - insert:
            tableName: partners
            columns:
              - column:
                  name: code
                  value: PTN001
              - column:
                  name: name
                  value: Công ty Cổ phần Công nghệ ABC
              - column:
                  name: email
                  value: contact@abc-tech.vn
              - column:
                  name: phone
                  value: '0241234567'
              - column:
                  name: address
                  value: '123 Đường ABC, Quận 1, TP.HCM'
              - column:
                  name: partner_type
                  value: CLIENT
              - column:
                  name: status
                  value: ACTIVE
              - column:
                  name: start_date
                  value: '2023-01-01'
              - column:
                  name: notes
                  value: 'Khách hàng lớn, hợp tác lâu dài'
        - insert:
            tableName: partners
            columns:
              - column:
                  name: code
                  value: PTN002
              - column:
                  name: name
                  value: Công ty TNHH Thiết bị XYZ
              - column:
                  name: email
                  value: sales@xyz-equipment.vn
              - column:
                  name: phone
                  value: '0241234568'
              - column:
                  name: address
                  value: '456 Đường XYZ, Quận 2, TP.HCM'
              - column:
                  name: partner_type
                  value: SUPPLIER
              - column:
                  name: status
                  value: ACTIVE
              - column:
                  name: start_date
                  value: '2023-06-01'
              - column:
                  name: notes
                  value: 'Nhà cung cấp thiết bị văn phòng'
        - insert:
            tableName: partners
            columns:
              - column:
                  name: code
                  value: PTN003
              - column:
                  name: name
                  value: Công ty Cổ phần Dịch vụ DEF
              - column:
                  name: email
                  value: info@def-services.vn
              - column:
                  name: phone
                  value: '0241234569'
              - column:
                  name: address
                  value: '789 Đường DEF, Quận 3, TP.HCM'
              - column:
                  name: partner_type
                  value: OTHER
              - column:
                  name: status
                  value: ACTIVE
              - column:
                  name: start_date
                  value: '2023-03-15'
              - column:
                  name: notes
                  value: 'Đối tác chiến lược trong lĩnh vực công nghệ'

  # Insert sample equipment
  - changeSet:
      id: 0004-sample-equipment
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO equipment (code, name, type, serial_number, status, purchase_date, purchase_price, notes, assigned_to_employee_id)
              SELECT 'EQP001', 'Laptop Dell XPS 15', 'Laptop', 'DLXPS2024001', 'ASSIGNED', '2024-01-15', 25000000, 'Laptop cao cấp cho lập trình viên',
                     (SELECT id FROM employees WHERE code = 'EMP003');
        - sql:
            sql: |
              INSERT INTO equipment (code, name, type, serial_number, status, purchase_date, purchase_price, notes, assigned_to_employee_id)
              SELECT 'EQP002', 'Laptop MacBook Pro M2', 'Laptop', 'MBPM22024002', 'ASSIGNED', '2024-01-20', 35000000, 'MacBook cho developer',
                     (SELECT id FROM employees WHERE code = 'EMP004');
        - sql:
            sql: |
              INSERT INTO equipment (code, name, type, serial_number, status, purchase_date, purchase_price, notes, assigned_to_employee_id)
              SELECT 'EQP003', 'Laptop ThinkPad X1 Carbon', 'Laptop', 'TPX1C2024003', 'ASSIGNED', '2024-02-01', 28000000, 'Laptop cho manager',
                     (SELECT id FROM employees WHERE code = 'EMP002');
        - insert:
            tableName: equipment
            columns:
              - column:
                  name: code
                  value: EQP004
              - column:
                  name: name
                  value: 'Màn hình Dell UltraSharp 27"'
              - column:
                  name: type
                  value: Monitor
              - column:
                  name: serial_number
                  value: 'DELLU272024004'
              - column:
                  name: status
                  value: AVAILABLE
              - column:
                  name: purchase_date
                  value: '2024-02-15'
              - column:
                  name: purchase_price
                  value: 8000000
              - column:
                  name: notes
                  value: 'Màn hình chưa được cấp phát'
        - insert:
            tableName: equipment
            columns:
              - column:
                  name: code
                  value: EQP005
              - column:
                  name: name
                  value: 'Điện thoại iPhone 15 Pro'
              - column:
                  name: type
                  value: Mobile Phone
              - column:
                  name: serial_number
                  value: 'IP15P2024005'
              - column:
                  name: status
                  value: ASSIGNED
              - column:
                  name: purchase_date
                  value: '2024-03-01'
              - column:
                  name: purchase_price
                  value: 28000000
              - column:
                  name: notes
                  value: 'Điện thoại công ty'
              - column:
                  name: assigned_to_employee_id
                  valueComputed: (SELECT id FROM employees WHERE code = 'EMP002')
        - insert:
            tableName: equipment
            columns:
              - column:
                  name: code
                  value: EQP006
              - column:
                  name: name
                  value: 'Bàn phím cơ Keychron K8'
              - column:
                  name: type
                  value: Keyboard
              - column:
                  name: serial_number
                  value: 'KCK82024006'
              - column:
                  name: status
                  value: MAINTENANCE
              - column:
                  name: purchase_date
                  value: '2023-12-01'
              - column:
                  name: purchase_price
                  value: 2500000
              - column:
                  name: notes
                  value: 'Đang bảo trì'

  # Insert sample attendance records (last 30 days)
  - changeSet:
      id: 0004-sample-attendance
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 1 DAY), '08:30:00', '17:30:00', 8.00, 'Làm việc bình thường'
              FROM employees e WHERE e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 2 DAY), '08:45:00', '17:45:00', 8.00, NULL
              FROM employees e WHERE e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 3 DAY), '09:00:00', '18:00:00', 8.00, 'Đến muộn 30 phút'
              FROM employees e WHERE e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 1 DAY), '08:00:00', '17:00:00', 8.00, NULL
              FROM employees e WHERE e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 2 DAY), '08:15:00', '17:15:00', 8.00, NULL
              FROM employees e WHERE e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 1 DAY), '08:30:00', '18:30:00', 9.00, 'Tăng ca 1 giờ'
              FROM employees e WHERE e.code = 'EMP002';
        - sql:
            sql: |
              INSERT INTO attendance_records (employee_id, work_date, check_in, check_out, worked_hours, notes)
              SELECT e.id, DATE_SUB(CURDATE(), INTERVAL 5 DAY), '08:00:00', '17:00:00', 8.00, NULL
              FROM employees e WHERE e.code IN ('EMP003', 'EMP004', 'EMP005', 'EMP006', 'EMP007', 'EMP008');

  # Insert sample leave requests
  - changeSet:
      id: 0004-sample-leave-requests
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO leave_requests (employee_id, type, start_date, end_date, total_days, reason, status, approver_id, decided_at)
              SELECT e.id, 'ANNUAL', DATE_ADD(CURDATE(), INTERVAL 7 DAY), DATE_ADD(CURDATE(), INTERVAL 9 DAY), 3.00, 'Nghỉ phép năm', 'APPROVED',
                     (SELECT id FROM employees WHERE code = 'EMP001'), NOW()
              FROM employees e WHERE e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO leave_requests (employee_id, type, start_date, end_date, total_days, reason, status)
              SELECT e.id, 'SICK', DATE_SUB(CURDATE(), INTERVAL 5 DAY), DATE_SUB(CURDATE(), INTERVAL 5 DAY), 1.00, 'Nghỉ ốm', 'PENDING'
              FROM employees e WHERE e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO leave_requests (employee_id, type, start_date, end_date, total_days, reason, status, approver_id, decided_at)
              SELECT e.id, 'OTHER', DATE_SUB(CURDATE(), INTERVAL 10 DAY), DATE_SUB(CURDATE(), INTERVAL 10 DAY), 1.00, 'Việc riêng', 'APPROVED',
                     (SELECT id FROM employees WHERE code = 'EMP001'), DATE_SUB(NOW(), INTERVAL 12 DAY)
              FROM employees e WHERE e.code = 'EMP005';
        - sql:
            sql: |
              INSERT INTO leave_requests (employee_id, type, start_date, end_date, total_days, reason, status)
              SELECT e.id, 'ANNUAL', DATE_ADD(CURDATE(), INTERVAL 15 DAY), DATE_ADD(CURDATE(), INTERVAL 19 DAY), 5.00, 'Nghỉ phép năm', 'PENDING'
              FROM employees e WHERE e.code = 'EMP007';

  # Insert sample payrolls (last 3 months)
  - changeSet:
      id: 0004-sample-payrolls
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO payrolls (employee_id, payroll_year, payroll_month, base_salary, overtime_hours, overtime_amount, bonus, deductions, net_pay, generated_at)
              SELECT e.id, YEAR(CURDATE()), MONTH(CURDATE()) - 1, e.base_salary, 10.00, 2000000, 1000000, 2000000, 
                     e.base_salary + 2000000 + 1000000 - 2000000, DATE_SUB(CURDATE(), INTERVAL 5 DAY)
              FROM employees e WHERE e.code = 'EMP003';
        - sql:
            sql: |
              INSERT INTO payrolls (employee_id, payroll_year, payroll_month, base_salary, overtime_hours, overtime_amount, bonus, deductions, net_pay, generated_at)
              SELECT e.id, YEAR(CURDATE()), MONTH(CURDATE()) - 1, e.base_salary, 8.00, 1600000, 500000, 2000000,
                     e.base_salary + 1600000 + 500000 - 2000000, DATE_SUB(CURDATE(), INTERVAL 5 DAY)
              FROM employees e WHERE e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO payrolls (employee_id, payroll_year, payroll_month, base_salary, overtime_hours, overtime_amount, bonus, deductions, net_pay, generated_at)
              SELECT e.id, YEAR(CURDATE()), MONTH(CURDATE()) - 2, e.base_salary, 15.00, 3000000, 2000000, 2000000,
                     e.base_salary + 3000000 + 2000000 - 2000000, DATE_SUB(CURDATE(), INTERVAL 35 DAY)
              FROM employees e WHERE e.code = 'EMP002';
        - sql:
            sql: |
              INSERT INTO payrolls (employee_id, payroll_year, payroll_month, base_salary, overtime_hours, overtime_amount, bonus, deductions, net_pay, generated_at)
              SELECT e.id, YEAR(CURDATE()), MONTH(CURDATE()) - 1, e.base_salary, 0.00, 0.00, 0.00, 1500000,
                     e.base_salary - 1500000, DATE_SUB(CURDATE(), INTERVAL 5 DAY)
              FROM employees e WHERE e.code = 'EMP005';

  # Insert sample expenses
  - changeSet:
      id: 0004-sample-expenses
      author: codex
      changes:
        - sql:
            sql: |
              INSERT INTO expenses (employee_id, project_id, category, amount, incurred_date, description, status)
              SELECT e.id, p.id, 'TRAVEL', 500000, DATE_SUB(CURDATE(), INTERVAL 3 DAY), 'Chi phí đi lại dự án', 'APPROVED'
              FROM employees e, projects p
              WHERE e.code = 'EMP003' AND p.code = 'PRJ001';
        - sql:
            sql: |
              INSERT INTO expenses (employee_id, project_id, category, amount, incurred_date, description, status)
              SELECT e.id, p.id, 'MEALS', 300000, DATE_SUB(CURDATE(), INTERVAL 2 DAY), 'Tiền ăn trưa với khách hàng', 'APPROVED'
              FROM employees e, projects p
              WHERE e.code = 'EMP002' AND p.code = 'PRJ002';
        - sql:
            sql: |
              INSERT INTO expenses (employee_id, project_id, category, amount, incurred_date, description, status)
              SELECT e.id, NULL, 'OFFICE_SUPPLIES', 200000, DATE_SUB(CURDATE(), INTERVAL 1 DAY), 'Mua văn phòng phẩm', 'SUBMITTED'
              FROM employees e WHERE e.code = 'EMP004';
        - sql:
            sql: |
              INSERT INTO expenses (employee_id, project_id, category, amount, incurred_date, description, status)
              SELECT e.id, p.id, 'TRAVEL', 800000, DATE_SUB(CURDATE(), INTERVAL 5 DAY), 'Chi phí đi công tác', 'APPROVED'
              FROM employees e, projects p
              WHERE e.code = 'EMP007' AND p.code = 'PRJ003';
        - sql:
            sql: |
              INSERT INTO expenses (employee_id, project_id, category, amount, incurred_date, description, status)
              SELECT e.id, NULL, 'EQUIPMENT', 5000000, DATE_SUB(CURDATE(), INTERVAL 7 DAY), 'Mua thiết bị phục vụ công việc', 'SUBMITTED'
              FROM employees e WHERE e.code = 'EMP002';

